{% extends "base.html" %}{% load url from future %}{% load media %}{% load staticfiles %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static "css/board.css" %}"/>
{% endblock %}

{% block content %}
    <h1>Bacheca messaggi</h1>

    <div>
        <form id='boardForm' action='' method='post'>
            <div id='board'>
                {% for message in board_messages %}
                    <div class='message' id="message-{{ message.id }}">
                        <div class='head'>
                            <div class='date'>
                                {{ message.date|date:"SHORT_DATE_FORMAT" }}
                            </div>
                            <div class='author'>
                                {{ message.author }}
                            </div>
                            {%  if message.attachment %}
                                <img class='attachment-mark' src='{% media_url "attachment.png" %}' width="32" height="32" />
                            {%  endif %}
                        </div>
                        <div class='m'>{{ message.message }}</div>
                        {%  if message.attachment %}
							<a href='{{ message.attachment.url }}'>{{ message.attachment_name }}</a>
                            {{ message.attachment.size|filesizeformat }}
                        {%  endif %}
                    </div>
                {% endfor %}
            </div>

            <div id='newMessageBoard'>
                <div>
                    <label for='m'>Nuovo messaggio:</label><br>
                    <textarea name='m' id='m'></textarea>
                </div>
                <input type="submit" value='Invia messaggio' disabled="disabled"/>
                <span id="status" class='warning'>Connessione in corso...</span>
            </div>
        </form>
    </div>

{% endblock content %}

{% block bottom %}
    {{ block.super }}
    <script type="text/javascript" src="{% static "board/board.js" %}"></script>
    <script>
        var messages = new Array();
        {% for message in board_messages %}
            var newMessage = {
                m: "{{ message.message|escapejs }}",
                a: "{{ message.author.username }}",
                d: "{{ message.date|date:"SHORT_DATE_FORMAT" }}",
                id: {{ message.id }}
            };
            messages.push(newMessage);
        {% endfor %}
{#        for (var i = 0; i < messages.length; i++) {#}
{#            addMessage(messages[i]);#}
{#        }#}

    </script>
    <script type="text/javascript" src="{%  static "socket.io.min.js" %}"></script>
{% endblock bottom %}
