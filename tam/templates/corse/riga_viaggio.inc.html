{% load utilTag %}
{% load media %}
{% load cache %}
<tr{% if viaggio.warning %} class="warning"{% endif %}>
{# {% cache 36000 viaggio viaggio.id %} #}
	<td>
		{% if not viaggio.conducente_confermato %}
			<input class="viaggioId" type="checkbox" name="viaggioId" value="{{viaggio.id}}" />
		{% endif %}
		{% if viaggio.padre_id %}
				<img src="{% media_url "frecciaverde.png" %}" alt="*" />
		{% else %}
			{% if viaggio.is_abbinata %}
				<img src="{% media_url "frecciagiu.png" %}" alt="." />
			{% endif %}
		{% endif %}
	</td>

	<td>
		{% include "corse/cella_ora_e_percorso.inc.html" %}
	</td>

	<td>
		{% include "corse/cella_cliente.inc.html" %}
	</td>

	{% include "corse/cella_partenza_arrivo.inc.html" %}

	<td>{% include "corse/cella_note.inc.html" %}</td>

	<td class='cellaPrezzo'>
		{% include "classifiche/descrizione-classifica-viaggio.inc.html" %}
	
		{% if viaggio.is_valid %}
			{{ viaggio.km }} km.
		{% else %}
			<span class='errorlist'>{{ viaggio.km }} km.</span>
		{% endif %}
		
		<br/>
		{% include "corse/corse_prezzo_viaggio.inc.html" %}
		{% include "corse/flags.inc.html" %}
	</td>

{# {% endcache %} #}

	<td>
	{% if viaggio.padre_id and not distinct %}
		<img src="{% media_url "arrow_join.png" %}" alt='' />
	{% else %}
		{% with viaggio.confirmed as confirmed %}
			{% if viaggio.conducente_richiesto %}
				<strong>no suppl:<br/>{{ viaggio.conducente }}</strong>
			{% else %}
				{% if confirmed %}
					{{ viaggio.conducente }}
				{% else %}
					{% with viaggio.classifica as classificaViaggio %}
					{% if classificaViaggio %}
						<form action="" method="post">
							<input type="hidden" name="viaggio" value="{{ viaggio.id }}" />
							<select name="conducente" style='display:block'>
								{% for conducente in classificaViaggio %}<option value="{{ conducente.id }}">{% if not conducente.attivo %}*inattivo*{% endif %}{% if conducente.assente %}*assente*{% endif %}{{ conducente }}</option>{% endfor %}
							</select>
							<input type="checkbox" name="confirmed" class="cbConducente" />
							{# <input type="submit" name="confirm" class='conducenteOkBtn' value="ok" /> #}
						</form>
					{% else %}
					    Nessun conducente disponibile
					{% endif %}
					{% endwith %}
				{% endif %}
			{% endif %}
			{% if confirmed %}<br/><img alt="confermato" src="{% media_url "ok.png" %}" /> {% endif %}
		{% endwith %}
        {% endif %}
	</td>
</tr>
